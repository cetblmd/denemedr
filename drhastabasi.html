<!DOCTYPE html>
<html lang="tr">
<head>
<link href="https://fonts.cdnfonts.com/css/aptos" rel="stylesheet">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doktor Hasta BaÅŸÄ± - Sesli Komutlu (Responsive)</title>

<style>
/* =========================================================
   DR HASTA BAÅI â€“ TEK CSS (Ã‡AKIÅMASIZ)
   Tema: ChatGPT + Zorunlu Eski Primary Actions
   ========================================================= */

/* ---------- Reset / Base ---------- */
*, *::before, *::after { box-sizing: border-box; }

:root{
  /* ChatGPT-vari */
  --bg-page: #f7f7f8;
  --bg-soft: #f3f4f6;
  --bg-panel:#ffffff;

  --text:#111827;
  --text-muted: rgba(17,24,39,.65);

  --border: rgba(0,0,0,.12);
  --border-strong: rgba(0,0,0,.18);

  --shadow-sm: 0 1px 2px rgba(0,0,0,.06);
  --shadow:    0 6px 16px rgba(0,0,0,.08);

  --accent:#10a37f;
  --accent-hover:#0e8f70;

  --radius:14px;
  --radius-sm:10px;

  /* Header heights */
  --hasta-h: 56px;
  --hizli-h: 48px;

  /* Desktop default widths */
  --sol-w: 25%;
  --sag-w: 75%;

  /* Zorunlu eski buton rengi */
  --legacy-primary:#0b3c61;
  --legacy-primary-hover:#0d4a78;

  /* Splitter */
  --splitter-w: 8px;

  --font:'Aptos', system-ui, -apple-system, Segoe UI, Roboto, Arial;
}

html, body { height: 100%; }
body{
  margin:0;
  font-family: var(--font);
  color: var(--text);
  background: var(--bg-page);
}





/* =========================================================
   DASHBOARD GRID (kutular yan yana)
   ========================================================= */
.dashboard-grid{
  display: flex;
  flex-wrap: wrap;
  gap: 16px;                 /* eski haline yakÄ±n */
  align-content: flex-start;
  justify-content: center;   /* istersen: flex-start */
  padding: 12px;
}

.dashboard-grid .kutu{
  width: 360px;              /* eski gÃ¶rÃ¼nÃ¼m: kart sabit geniÅŸlik */
  max-width: 100%;
}

/* Daha bÃ¼yÃ¼k ekranda 3-4â€™lÃ¼ dizilimi rahatlat */
@media (min-width: 1200px){
  .dashboard-grid .kutu{ width: 380px; }
}




/* =========================================================
   HEADER (1. satÄ±r)  #hasta-ozet
   ========================================================= */
#hasta-ozet{
  position: sticky;
  top: 0;
  z-index: 1000;

  height: var(--hasta-h);
  min-height: var(--hasta-h);

  display:flex;
  align-items:center;
  gap:10px;

  padding: 0 14px;
  background: rgba(247,247,248,.92);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
}

/* Sol blok (avatar + text) â€” saÄŸ butonlar sÄ±kÄ±ÅŸtÄ±rmasÄ±n */
#hasta-ozet > div:first-child{
  display:flex;
  align-items:center;
  gap:10px;
  flex: 1 1 auto;
  min-width: 0;
}

/* Hasta avatarÄ± (SVG) â€” gerÃ§ek â€œresimâ€ bu */
#hasta-ozet .hasta-avatar{
  width: 34px;
  height: 34px;
  min-width: 34px;
  min-height: 34px;
  flex-shrink: 0;

  border-radius: 999px;
  overflow: hidden;
  border: 1px solid var(--border);
  background: var(--bg-panel);

  display:inline-flex;
  align-items:center;
  justify-content:center;
}
#hasta-ozet .hasta-avatar svg{
  width: 34px;
  height: 34px;
  display:block;
}

/* SaÄŸ buton alanÄ± */
#hasta-ozet .ust-butons{
  margin-left: auto;
  display:flex;
  align-items:center;
  gap:10px;
  flex-shrink: 0;
}

/* 1. satÄ±rdaki butonlarda yuvarlak iÃ§ gÃ¶rÃ¼nÃ¼mÃ¼ kaldÄ±r */
#hasta-ozet .btn-group.view-actions button,
#hasta-ozet .icon-btn,
#hasta-ozet .icon-btn2{
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  border-radius: 0 !important;
}
	


/* =========================================================
   ğŸ”’ ZORUNLU ESKÄ° BUTONLAR (primary-actions)
   Ä°laÃ§ YÃ¶netimi / e-NabÄ±z / SGK / SÄ°NA
   ========================================================= */
#hasta-ozet .btn-group.primary-actions{
  display:flex;
  gap:6px;
  align-items:center;
}

/* Boyutu kilitle (SGK bÃ¼yÃ¼mesin) */
#hasta-ozet .btn-group.primary-actions button,
#hasta-ozet .btn-group.primary-actions .enabiz-btn{
  height: 30px;
  line-height: 30px;
  padding: 0 10px;
  font-size: 13px;
  white-space: nowrap;

  background: var(--legacy-primary);
  color:#fff;
  border:none;
  border-radius: 5px;
  cursor:pointer;

  box-shadow:none;
}
#hasta-ozet .btn-group.primary-actions button:hover,
#hasta-ozet .btn-group.primary-actions .enabiz-btn:hover{
  background: var(--legacy-primary-hover);
}

/* e-nabÄ±z iÃ§indeki logo */
#hasta-ozet .btn-group.primary-actions .enabiz-btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
}
#hasta-ozet .btn-group.primary-actions .enabiz-btn img{
  height: 18px;
  width: auto;
  display:block;
}

/* =========================================================
   ChatGPT-stili ikon butonlar (view-actions)
   ========================================================= */
.btn-group{ display:flex; align-items:center; gap:6px; }

.btn-group.view-actions{
  display:flex;
  align-items:center;
  gap:6px;

  padding-left: 10px;
  border-left: 1px solid var(--border);
}

.btn-group.view-actions button{
  width:34px;
  height:34px;
  border-radius: 999px;

  border:1px solid var(--border);
  background: var(--bg-panel);
  box-shadow: var(--shadow-sm);

  cursor:pointer;
  transition: background .15s ease, box-shadow .15s ease, border-color .15s ease;
}
.btn-group.view-actions button:hover{
  background: var(--bg-soft);
  border-color: var(--border-strong);
  box-shadow: var(--shadow);
}







/* mic on */
#hasta-ozet .icon-btn.mic-on{
  background: var(--accent);
  border-color: rgba(16,163,127,.55);
  color:#fff;
}

/* =========================================================
   HEADER (2. satÄ±r)  #hizli-aksiyon-bar
   ========================================================= */
#hizli-aksiyon-bar{
  position: sticky;
  top: var(--hasta-h);
  z-index: 999;

  height: var(--hizli-h);
  min-height: var(--hizli-h);

  display:flex;
  align-items:center;
  gap:6px;

  padding: 0 10px;
  background: rgba(247,247,248,.92);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
}

#hizli-aksiyon-bar button,
#hizli-aksiyon-bar .icon-btn2{
  width:34px;
  height:34px;
  border-radius: 10px;

  border: 1px solid transparent;
  background: transparent;
  cursor:pointer;

  display:inline-flex;
  align-items:center;
  justify-content:center;

  transition: background .15s ease, border-color .15s ease;
}
#hizli-aksiyon-bar button:hover,
#hizli-aksiyon-bar .icon-btn2:hover{
  background: var(--bg-soft);
  border-color: var(--border);
}

/* =========================================================
   MAIN LAYOUT
   ========================================================= */
.main-content-wrapper{
  display:flex;
  flex-direction: row;
  height: calc(100vh - (var(--hasta-h) + var(--hizli-h)));
  overflow:hidden;
  background: var(--bg-page);
}

/* Sol panel */
.sol-panel{
  width: var(--sol-w);
  min-width: 240px;
  max-width: 98vw;

  padding: 10px;
  background: var(--bg-page);
  overflow-y: auto;

  display:flex;
  flex-direction: column;
  gap: 12px;
}

/* SaÄŸ panel */
.sag-icerik{
  width: var(--sag-w);
  padding: 12px;
  background: var(--bg-page);
  overflow-y: auto;
}

/* =========================================================
   CARDS (kutu) â€“ ChatGPT hissi
   ========================================================= */
.kutu{
  position: relative;

  background: var(--bg-panel);
  border: 1px solid var(--border);
  border-radius: var(--radius);

  padding: 12px;
  box-shadow: var(--shadow-sm);

  cursor: pointer;
  transition: box-shadow .15s ease, border-color .15s ease, transform .06s ease;
}
.kutu:hover{
  border-color: var(--border-strong);
  box-shadow: var(--shadow);
}
.kutu:active{ transform: translateY(1px); }

.kutu-baslik{
  display:flex;
  align-items:center;
  gap:8px;

  font-weight: 700;
  font-size: 14px;
  margin-bottom: 8px;
}

.kutu-toggle-btn{
  width:22px;
  height:22px;
  border-radius: 999px;

  border:1px solid var(--border);
  background: var(--bg-panel);
  box-shadow: var(--shadow-sm);

  cursor:pointer;
}
.kutu-toggle-btn:hover{
  background: var(--bg-soft);
  border-color: var(--border-strong);
}

.kutu .ac-icon{
  position:absolute;
  top: 10px;
  right: 10px;

  width: 28px;
  height: 28px;
  border-radius: 10px;

  display:flex;
  align-items:center;
  justify-content:center;

  color: var(--text-muted);
}
.kutu .ac-icon:hover{
  background: var(--bg-soft);
  color: var(--text);
}

.kutu.active{
  border-color: rgba(16,163,127,.5);
  box-shadow: 0 0 0 3px rgba(16,163,127,.18), var(--shadow);
}

/* Desktop: sol panel collapsed */
@media (min-width: 769px){
  .sol-panel .kutu.collapsed > *:not(.kutu-baslik):not(.ac-icon){
    display:none;
    max-height:0;
    overflow:hidden;
  }
}

/* Muayene Ã¶zet clamp */
.muayene-ozet{
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow:hidden;
  text-overflow: ellipsis;
  color: var(--text-muted);
}

/* Small images */
.kucuk-resim{
  width: 52px;
  height: 52px;
  border-radius: 12px;
  object-fit: cover;
  border: 1px solid var(--border);
  background: var(--bg-soft);
}

/* Iframe */
.hasta-bilgisi-embed{
  width:100%;
  border-radius: 12px;
  overflow:hidden;
  border: 1px solid var(--border);
  background: var(--bg-panel);
}
.hasta-bilgisi-embed iframe{
  width:100%;
  border:none;
  background: transparent;
  min-height: 360px;
}

/* =========================================================
   TABLES â€“ temiz gÃ¶rÃ¼nÃ¼m
   ========================================================= */
table{
  width:100%;
  border-collapse: separate;
  border-spacing: 0;
  background: var(--bg-panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow:hidden;
  font-size: 13px;
}
th, td{
  padding: 8px 10px;
  border-bottom: 1px solid var(--border);
  vertical-align: top;
}
tr:last-child td{ border-bottom: none; }
th{
  background: var(--bg-soft);
  color: var(--text);
  font-weight: 700;
}

/* Lab: sol panelde 6 satÄ±r scroll */
.kutu[data-turu="laboratuvar"] table tbody{
  display:block;
  max-height: calc(6 * 34px);
  overflow-y: auto;
}
.kutu[data-turu="laboratuvar"] table thead,
.kutu[data-turu="laboratuvar"] table tbody tr{
  display: table;
  width: 100%;
  table-layout: fixed;
}

/* SaÄŸ panelde iÃ§ scroll olmasÄ±n */
.sag-icerik .kutu[data-turu="laboratuvar"] table tbody{
  display: table-row-group;
  max-height: none;
  overflow: visible;
}

/* =========================================================
   INCE PANEL + SPLITTER
   ========================================================= */
.ince-splitter{
  width: var(--splitter-w);
  cursor: col-resize;
  position: relative;
  background: transparent;
}
.ince-splitter::after{
  content:"";
  position:absolute;
  top:10px;
  bottom:10px;
  left:50%;
  width:2px;
  transform: translateX(-50%);
  background: rgba(0,0,0,.15);
  border-radius: 2px;
}
body.ince-hidden .ince-splitter{ display:none; }

/* Ä°nce panel saÄŸda */
body.ince-right #mainWrapper{
  flex-direction: row-reverse;
}

/* Ä°nce panel solda (default) */
body.ince-left #mainWrapper{
  flex-direction: row;
}

/* =========================================================
   EDGE MENU (isteÄŸe baÄŸlÄ± mevcut davranÄ±ÅŸ)
   ========================================================= */
.edge-menu{
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  max-height: 70vh;

  background: rgba(247,247,248,.92);
  backdrop-filter: blur(10px);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow:hidden;

  display:flex;
  align-items: stretch;
  transition: width .22s ease, box-shadow .22s ease;
  z-index: 1200;
}
.edge-menu.left{ left: 5px; flex-direction: row;}
.edge-menu.right{ right: 5px; }
.edge-menu:hover{ box-shadow: var(--shadow); 
		  width: fit-content;
}


/* Sol menÃ¼ AÃ‡ILINCA: kulakÃ§Ä±k iÃ§ kenara gelsin */
.edge-menu.left:hover{
  flex-direction: row-reverse;   /* tab saÄŸa geÃ§er, iÃ§erik sola */
  width: fit-content;
}



/* KÃ¶ÅŸe yuvarlaklarÄ±nÄ± da doÄŸru Ã§evir */
.edge-menu.left .edge-menu-tab{
  border-radius: 0 10px 10px 0;
}
.edge-menu.left:hover .edge-menu-tab{
  border-radius: 10px 0 0 10px;
}

.edge-menu-tab{
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  padding: 6px 4px;
  background: var(--accent);
  color:#fff;
  font-weight: 700;
  font-size: 11px;
  text-align:center;
  cursor:pointer;
  flex-shrink:0;

background: #e5e7eb;          /* aÃ§Ä±k gri */
color: #374151;               /* koyu ama yumuÅŸak yazÄ± */
border: 1px solid rgba(0,0,0,.08);
}



.edge-menu-content{
  padding: 10px;
  display:flex;
  flex-direction: column;
  gap: 8px;
  white-space: nowrap;
}
.edge-menu-content button{
  width: 100%;
  border: 1px solid var(--border);
  background: var(--bg-panel);
  color: var(--text);
  border-radius: 10px;
  padding: 8px 10px;
  cursor:pointer;
  text-align:left;
  box-shadow: var(--shadow-sm);
}
.edge-menu-content button:hover{
  background: var(--bg-soft);
  border-color: var(--border-strong);
}

/* =========================================================
   MODALS (kendi sistemin iÃ§in temel)
   ========================================================= */
.menu-modal{
  display:none;
  position: fixed;
  inset: 0;
  z-index: 20000;
  background: rgba(0,0,0,.45);
}
.menu-modal.active{ display:block; }

.menu-modal-content{
  background: var(--bg-panel);
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  border-radius: 16px;

  width: min(420px, 92vw);
  margin: 10vh auto 0;
  padding: 12px;

  position: relative;
  z-index: 20001;
}

/* Detail modal */
.detail-modal{
  display:none;
  position: fixed;
  inset: 0;
  z-index: 10000;
  background: var(--bg-page);
  overflow-y: auto;
}
.detail-modal.active{ display:block; }

.detail-modal-header{
  position: sticky;
  top:0;
  z-index: 10001;

  height: 54px;
  display:flex;
  align-items:center;
  gap: 10px;

  padding: 0 10px;
  background: rgba(247,247,248,.92);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
}
.detail-modal-header h3{
  margin:0;
  font-size: 15px;
  font-weight: 800;
  flex: 1;
  text-align: center;
}
.detail-modal-header .back-btn{
  border: 1px solid var(--border);
  background: var(--bg-panel);
  width: 40px;
  height: 40px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 22px;
  line-height: 1;
}
.detail-modal-content{ padding: 12px; }

/* =========================================================
   TABLET
   ========================================================= */
@media (max-width: 1024px) and (min-width: 769px){
  :root{
    --hasta-h: 48px;
    --hizli-h: 42px;
    --sol-w: 35%;
    --sag-w: 65%;
  }
}

/* VarsayÄ±lan (PC/Tablet): mobil menÃ¼ tamamen kapalÄ± */
#mobileMenuToggle,
.menu-modal{
  display: none !important;
}

/* =========================================================
   MOBILE
   ========================================================= */
@media (max-width: 768px){
  /* Mobilde kesilme olmamasÄ± iÃ§in sticky kapat */
  #hasta-ozet, #hizli-aksiyon-bar{
    position: static;
    top: auto;
    backdrop-filter: none;
    height: auto;
    min-height: 0;
  }

  .main-content-wrapper{
    margin-top: 0 !important;
    padding-top: 0 !important;
    min-height: unset !important;

    flex-direction: column;
    height: auto;
    overflow: visible;
  }

  .sol-panel, .sag-icerik{
    width: 100%;
    min-width: 0;
    height: auto;
  }

  .sag-icerik{ display:none; }

  /* Mobil kart: kapalÄ± varsayÄ±m; .active aÃ§ar */
  .kutu > *:not(.kutu-baslik):not(.ac-icon){ display:none; }
  .kutu.active > *:not(.kutu-baslik):not(.ac-icon){ display:block; }

  /* Mobilde splitter/butonlar gizli */
  #inceLeftBtn, #inceHideBtn, #inceRightBtn,
  .ince-splitter{ display:none; }

  /* Edge menu gizli */
  .edge-menu{ display:none; }

  /* Mobil menÃ¼ toggle gÃ¶steriyorsan (varsa) */
  #mobileMenuToggle{
    display:flex !important;
    width: 38px;
    height: 38px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--bg-panel);
    box-shadow: var(--shadow-sm);
    align-items:center;
    justify-content:center;
    margin-left: 8px;
  }


  /* === MODAL ARKA PLAN === */
  .menu-modal{
    background: rgba(0,0,0,.25);
    padding: 12px;
  }

  /* === MODAL Ä°Ã‡ KART === */
  .menu-modal-content{
    width: 100%;
    max-width: none;
    max-height: calc(100vh - 24px);
    background: #f7f7f8;
    border-radius: 14px;
    padding: 14px;
    overflow-y: auto;
    box-shadow: 0 10px 24px rgba(0,0,0,.18);
  }

  /* === HEADER (BaÅŸlÄ±k + Kapat) === */
  .menu-header{
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .menu-header h3{
    margin: 0;
    font-size: 16px;
    font-weight: 800;
    color: #111827;
  }

  .menu-header .close-btn{
    width: 34px;
    height: 34px;
    border-radius: 10px;
    border: 1px solid rgba(0,0,0,.12);
    background: #fff;
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
  }

  /* === MENÃœ GRUPLARI === */
  .menu-group{
    margin-top: 14px;
  }

  .menu-group h4{
    margin: 0 0 8px;
    font-size: 13px;
    font-weight: 700;
    color: rgba(17,24,39,.7);
  }

  /* === BUTON GRID (2 sÃ¼tun) === */
  .menu-group{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  /* Grup baÅŸlÄ±ÄŸÄ± gridâ€™i bozmasÄ±n */
  .menu-group h4{
    grid-column: 1 / -1;
  }

  /* === MENÃœ BUTONLARI === */
  .menu-group button{
    width: 100%;
    padding: 10px 10px;
    border-radius: 12px;
    border: 1px solid rgba(0,0,0,.10);
    background: #fff;
    font-size: 13px;
    font-weight: 600;
    text-align: left;
    cursor: pointer;
  }

  /* Dokunma geri bildirimi (senin eklediÄŸin â€“ KALSIN ğŸ‘) */
  .menu-modal-content button:active{
    transform: translateY(1px);
  }

  /* === AYARLAR ALT MENÃœ === */
  #mobileSettingsMainBtn{
    grid-column: 1 / -1;
    background: #eef0f3;
    font-weight: 700;
  }

  .settings-submenu{
    grid-column: 1 / -1;
    display: none;
    margin-top: 6px;
  }

  .settings-submenu button{
    background: #fff;
  }


  /* 1. satÄ±r: alt alta diz */
  #hasta-ozet{
    flex-wrap: wrap;
    align-items: flex-start;
  }

  /* Hasta bilgisi tam satÄ±r */
  #hasta-ozet .hasta-bilgi{
    flex: 0 0 100%;
    max-width: 100%;
  }

  /* SGK / e-NabÄ±z / Ä°laÃ§ / SÄ°NA butonlarÄ± alt satÄ±ra */
  #hasta-ozet .ust-butons{
    flex: 0 0 100%;
    max-width: 100%;
    margin-left: 0;
    margin-top: 6px;

    justify-content: flex-end; /* saÄŸda kalsÄ±n */
  }

  /* 1. satÄ±rda buton bloÄŸu tam geniÅŸlik olsun */
  #hasta-ozet .ust-butons{
    width: 100%;
    margin-left: 0;
    justify-content: flex-end;
    flex-wrap: wrap;        /* gerekiyorsa alta insin */
    gap: 6px;
  }

  /* SGK/e-NabÄ±z/Ä°laÃ§/SÄ°NA grubu taÅŸmasÄ±n */
  #hasta-ozet .btn-group.primary-actions{
    display: flex;
    flex-wrap: wrap;        /* ğŸ”´ kritik */
    justify-content: flex-end;
    max-width: 100%;
    gap: 6px;
  }

  /* Butonlar ekrandan dÄ±ÅŸarÄ± taÅŸmasÄ±n */
  #hasta-ozet .btn-group.primary-actions button,
  #hasta-ozet .btn-group.primary-actions .enabiz-btn{
    max-width: 100%;
    flex: 0 0 auto;
  }

  /* Alt satÄ±ra inen butonlar biraz daha sÄ±kÄ± dursun */
  #hasta-ozet .btn-group.primary-actions{
    row-gap: 4px;
  }

  /* Buton yazÄ±larÄ± Ã§ok uzunsa taÅŸmayÄ± Ã¶nle */
  #hasta-ozet .btn-group.primary-actions button,
  #hasta-ozet .btn-group.primary-actions .enabiz-btn{
    white-space: nowrap;
  }

  /* mobilde bÃ¼yÃ¼teÃ§ â†’ full aÃ§Ä±k kart */
  .detail-modal-content .kutu > *:not(.kutu-baslik){
    display: block !important;
    max-height: none !important;
    overflow: visible !important;
  }

  .detail-modal-content .kutu .kutu-toggle-btn,
  .detail-modal-content .kutu .ac-icon{
    display: none !important;
  }



}




/* =========================================================
   VOICE BOX (varsa)
   ========================================================= */
#voice-command-box{
  position: fixed;
  bottom: 10px;
  left: 10px;
  z-index: 9999;

  background: rgba(17,24,39,.92);
  color:#fff;
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 14px;
  padding: 8px 10px;
  box-shadow: var(--shadow);
  font-size: 12px;
  max-width: 320px;
}
#voice-command-box span{ font-weight: 800; }




</style>


</head>
<body>
<div id="hasta-ozet">
    <div style="display:flex; align-items:center; gap:10px;">
                <div class="hasta-avatar" aria-hidden="true">
                    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="hbGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#0f766e"/>
                                <stop offset="100%" stop-color="#0369a1"/>
                            </linearGradient>
                        </defs>
                        <circle cx="32" cy="32" r="32" fill="url(#hbGrad)" />
                        <path d="M16 52c2.5-8.5 8-13 16-13s13.5 4.5 16 13" fill="#e5e7eb" opacity="0.9"/>
                        <circle cx="32" cy="26" r="9" fill="#f9fafb"/>
                    </svg>
                </div>
        <span>Ahmet YÄ±lmaz - 35 / Erkek</span>
    </div>

    <div class="ust-butons">
        <div class="btn-group primary-actions">
            <button>ğŸ’Š Ä°laÃ§ YÃ¶netimi</button>
            <button class="enabiz-btn" title="e-NabÄ±z">
                <img src="https://picsum.photos/18?random=5" alt="e-NabÄ±z" style="height:18px; width:auto; display:block;">
            </button>
            <button>ğŸ§¾ SGK</button>
            <button>ğŸ©º SÄ°NA</button>
        </div>

        <div class="btn-group view-actions">
            <button class="icon-btn" id="mikrofonToggleBtn" title="Mikrofon BaÅŸlat/Durdur">ğŸ¤</button>
            <button class="icon-btn" id="fullscreenToggleBtn" title="Tam ekran Dashboard">ğŸ–¥ï¸</button>
	    <button class="icon-btn" id="leftAllExpandBtn" title="Sol panelde tÃ¼m iÃ§erikleri gÃ¶ster">ğŸ“œ</button>


<div id="incePanelButtons" class="ince-panel-buttons">
  <button id="inceLeftBtn"  class="icon-btn" title="Ä°nce paneli sola al">
    <!-- SOL 1/4 DOLU -->
    <svg width="24" height="16" viewBox="0 0 24 16" xmlns="http://www.w3.org/2000/svg">
      <rect x="1" y="1" width="22" height="14" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
      <rect x="1" y="1" width="5.5" height="14" rx="2" ry="2" fill="currentColor"/>
    </svg>
  </button>

  <button id="inceHideBtn" class="icon-btn" title="Ä°nce paneli gizle">
    <!-- BOÅ -->
    <svg width="24" height="16" viewBox="0 0 24 16" xmlns="http://www.w3.org/2000/svg">
      <rect x="1" y="1" width="22" height="14" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
    </svg>
  </button>

  <button id="inceRightBtn" class="icon-btn" title="Ä°nce paneli saÄŸa al">
    <!-- SAÄ 1/4 DOLU -->
    <svg width="24" height="16" viewBox="0 0 24 16" xmlns="http://www.w3.org/2000/svg">
      <rect x="1" y="1" width="22" height="14" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
      <rect x="17.5" y="1" width="5.5" height="14" rx="2" ry="2" fill="currentColor"/>
    </svg>
  </button>
</div>


            <button class="icon-btn" id="hizliBarToggleBtn" title="HÄ±zlÄ± Aksiyon BarÄ±nÄ± AÃ§/Kapat">â¬‡ï¸</button>
	    <button class="icon-btn" id="mobileMenuToggle" title="Mobil MenÃ¼">â˜°</button>        </div>
    </div>
</div>


<div id="hizli-aksiyon-bar"></div>

<div class="main-content-wrapper" id="mainWrapper">
    <div class="sol-panel" id="solPanel">
        <!-- KUTULAR (senin son versiyonun) -->
	  <div class="kutu" id="panel-hasta-bilgisi" data-turu="hasta-bilgisi">
    <div class="kutu-baslik">Hasta Bilgisi</div>
    <span class="ac-icon">ğŸ”</span>

    <div class="hasta-bilgisi-embed">
        <iframe
            id="hastaBilgisiFrame"
            src="hastabilgisi.html"
            loading="lazy"
            onload="resizeHastaBilgisiFrame()">
        </iframe>
    </div>
</div>

        <div class="kutu" id="panel-muayene" data-turu="muayene">
            <div class="kutu-baslik">Muayene Bilgileri</div>
            <span class="ac-icon">ğŸ”</span>
            <table>
                <tbody>
                    <tr><td>Muayenesi</td><td class="muayene-ozet">Ayakta genel durum iyi, nabÄ±z 78, solunum normal, gÃ¶zler canlÄ± ve refleksler dÃ¼zenli...</td></tr>
                    <tr><td>Åikayeti</td><td class="muayene-ozet">SÄ±rt aÄŸrÄ±sÄ±, baÅŸ dÃ¶nmesi, ara sÄ±ra yorgunluk ve halsizlik belirtileri mevcut...</td></tr>
                    <tr><td>Ã–ykÃ¼sÃ¼</td><td class="muayene-ozet">7 ay Ã¶nce baÅŸlayan aÄŸrÄ±, ilerleyen haftalarda hafifledi ancak bazen uzun sÃ¼re oturunca tekrar artÄ±yor...</td></tr>
                    <tr><td>Tedavisi</td><td class="muayene-ozet">Fizik tedavi, egzersiz programÄ± ve aÄŸrÄ± kesici dÃ¼zenli olarak uygulanmakta...</td></tr>
                    <tr><td>Anamnezi</td><td class="muayene-ozet">Hipertansiyon ve hafif astÄ±m Ã¶ykÃ¼sÃ¼ mevcut, ailede diyabet ve kalp hastalÄ±ÄŸÄ± geÃ§miÅŸi...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="kutu" id="panel-teshis" data-turu="teshis">
            <div class="kutu-baslik">TeÅŸhis KodlarÄ±</div>
            <span class="ac-icon">ğŸ”</span>
            <table>
                <tbody>
                    <tr><td>ICD10: M54.5</td><td>Bel aÄŸrÄ±sÄ±</td></tr>
                    <tr><td>ICD10: I10</td><td>Hipertansiyon</td></tr>
                    <tr><td>ICD10: E11</td><td>Tip 2 Diyabet</td></tr>
                    <tr><td>ICD10: J45</td><td>AstÄ±m</td></tr>
                </tbody>
            </table>
        </div>

        <div class="kutu" id="panel-laboratuvar" data-turu="laboratuvar">
            <div class="kutu-baslik">Laboratuvar SonuÃ§larÄ±</div>
            <span class="ac-icon">ğŸ”</span>
            <table>
                <thead>
                    <tr><th>Test</th><th>SonuÃ§</th><th>Referans</th></tr>
                </thead>
                <tbody>
                    <tr><td>HbA1c</td><td>7.2%</td><td>4.0 - 6.0%</td></tr>
                    <tr><td>AÃ§lÄ±k Glukoz</td><td>132 mg/dL</td><td>70 - 100 mg/dL</td></tr>
                    <tr><td>Kreatinin</td><td>1.3 mg/dL</td><td>0.6 - 1.2 mg/dL</td></tr>
                    <tr><td>eGFR</td><td>58 mL/dk</td><td>&gt; 90 mL/dk</td></tr>
                    <tr><td>LDL Kolesterol</td><td>130 mg/dL</td><td>&lt; 100 mg/dL</td></tr>
                    <tr><td>Trigliserid</td><td>210 mg/dL</td><td>&lt; 150 mg/dL</td></tr>
                    <tr><td>ALT</td><td>32 U/L</td><td>&lt; 40 U/L</td></tr>
                    <tr><td>AST</td><td>29 U/L</td><td>&lt; 40 U/L</td></tr>
                    <tr><td>CRP</td><td>3.2 mg/L</td><td>&lt; 5 mg/L</td></tr>
                    <tr><td>WBC</td><td>7.8 x10Â³/ÂµL</td><td>4.0 - 11.0</td></tr>
                    <tr><td>Hgb</td><td>13.1 g/dL</td><td>13.0 - 17.0 g/dL</td></tr>
                    <tr><td>Plt</td><td>260 x10Â³/ÂµL</td><td>150 - 400</td></tr>
                    <tr><td>Vitamin D</td><td>18 ng/mL</td><td>30 - 100 ng/mL</td></tr>
                    <tr><td>TSH</td><td>2.1 ÂµIU/mL</td><td>0.4 - 4.0 ÂµIU/mL</td></tr>
                </tbody>
            </table>
        </div>

        <div class="kutu" id="panel-radyoloji" data-turu="radyoloji">
            <div class="kutu-baslik">Radyoloji SonuÃ§larÄ±</div>
            <span class="ac-icon">ğŸ”</span>
            <table>
                <tbody>
                    <tr>
                        <td><img class="kucuk-resim" src="https://picsum.photos/50?random=2" alt="MR"></td>
                        <td>Lomber MR: L4-L5 seviyesinde minimal protrÃ¼zyon, sinir kÃ¶klerine belirgin basÄ± izlenmedi.</td>
                    </tr>
                    <tr>
                        <td><img class="kucuk-resim" src="https://picsum.photos/50?random=3" alt="BT"></td>
                        <td>Beyin BT: Akut patoloji saptanmadÄ±, kronik iskemik odaklar izleniyor.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="kutu" id="panel-recete" data-turu="recete">
            <div class="kutu-baslik">Ä°laÃ§ ReÃ§eteleri</div>
            <span class="ac-icon">ğŸ”</span>
            <table>
                <tbody>
                    <tr><td>Metformin 1000 mg</td><td>2x1</td></tr>
                    <tr><td>Amlodipin 5 mg</td><td>1x1</td></tr>
                    <tr><td>Ä°nhaler BronkodilatÃ¶r</td><td>GÃ¼nde 2-3 kez</td></tr>
                    <tr><td>Omeprazol 20 mg</td><td>1x1 (Sabah aÃ§)</td></tr>
                </tbody>
            </table>
        </div>

        <div class="kutu" id="panel-asi" data-turu="asi">
            <div class="kutu-baslik">AÅŸÄ± ve BaÄŸÄ±ÅŸÄ±klama</div>
            <span class="ac-icon">ğŸ”</span>
            <div class="responsive-table-container">
                <div class="responsive-header">
                    <div class="col-adi">AÅŸÄ± AdÄ±</div>
                    <div class="col-doz">Doz</div>
                    <div class="col-tarih">Son Uygulama</div>
                    <div class="col-sonraki">Sonraki Doz</div>
                    <div class="col-durum">Durum</div>
                </div>

                <div class="responsive-row">
                    <div class="col-adi"><span class="label">AÅŸÄ± AdÄ±:</span>Tetanoz (Td)</div>
                    <div class="col-doz"><span class="label">Doz:</span>Rutin</div>
                    <div class="col-tarih"><span class="label">Son Uygulama:</span>12.05.2020</div>
                    <div class="col-sonraki"><span class="label">Sonraki Doz:</span>12.05.2030</div>
                    <div class="col-durum"><span class="label">Durum:</span>GÃ¼ncel</div>
                </div>

                <div class="responsive-row">
                    <div class="col-adi"><span class="label">AÅŸÄ± AdÄ±:</span>Grip AÅŸÄ±sÄ±</div>
                    <div class="col-doz"><span class="label">Doz:</span>YÄ±llÄ±k</div>
                    <div class="col-tarih"><span class="label">Son Uygulama:</span>10.11.2024</div>
                    <div class="col-sonraki"><span class="label">Sonraki Doz:</span>10.11.2025</div>
                    <div class="col-durum"><span class="label">Durum:</span>PlanlandÄ±</div>
                </div>

                <div class="responsive-row uyari">
                    <div class="col-adi"><span class="label">AÅŸÄ± AdÄ±:</span>PnÃ¶mokok (PPV23)</div>
                    <div class="col-doz"><span class="label">Doz:</span>1 Doz</div>
                    <div class="col-tarih"><span class="label">Son Uygulama:</span>01.03.2018</div>
                    <div class="col-sonraki"><span class="label">Sonraki Doz:</span>Doktor kararÄ± ile tekrar</div>
                    <div class="col-durum"><span class="label">Durum:</span>GÃ¶zden geÃ§ir</div>
                </div>

                <div class="responsive-row">
                    <div class="col-adi"><span class="label">AÅŸÄ± AdÄ±:</span>Covid-19 Bivalan</div>
                    <div class="col-doz"><span class="label">Doz:</span>3. Doz</div>
                    <div class="col-tarih"><span class="label">Son Uygulama:</span>15.01.2023</div>
                    <div class="col-sonraki"><span class="label">Sonraki Doz:</span>GÃ¼ncel rehbere gÃ¶re</div>
                    <div class="col-durum"><span class="label">Durum:</span>Ã–nerilebilir</div>
                </div>
            </div>
        </div>

        <div class="kutu" id="panel-notlar" data-turu="notlar">
            <div class="kutu-baslik">Hekim NotlarÄ± ve Plan</div>
            <span class="ac-icon">ğŸ”</span>
            <ul>
                <li>Bel fÄ±tÄ±ÄŸÄ± aÃ§Ä±sÄ±ndan nÃ¶rolojik muayene tekrarlanacak.</li>
                <li>Gerekirse nÃ¶roÅŸirÃ¼rji konsÃ¼ltasyonu istenecek.</li>
                <li>Kilo kontrolÃ¼ ve egzersiz programÄ±na uyum vurgulandÄ±.</li>
                <li>Kan ÅŸekeri regÃ¼lasyonu iÃ§in endokrinoloji ile iletiÅŸim.</li>
            </ul>
        </div>

        <div class="kutu" id="panel-randevu" data-turu="randevu">
            <div class="kutu-baslik">Randevu ve Kontroller</div>
            <span class="ac-icon">ğŸ”</span>
            <table>
                <tbody>
                    <tr><td>Kontrol Muayene</td><td>15.12.2025 - 09:30</td></tr>
                    <tr><td>Fizik Tedavi SeansÄ±</td><td>Her hafta SalÄ±/PerÅŸembe</td></tr>
                    <tr><td>GÃ¶z KontrolÃ¼</td><td>20.01.2026 - 14:00</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="inceSplitter" class="ince-splitter" aria-hidden="true"></div>

    <div class="sag-icerik" id="sagPanel">
        <div id="sag-icerik-icerik">
            <div class="kutu">
                <div class="kutu-baslik">SaÄŸ Panel BaÅŸlangÄ±Ã§ Ä°Ã§eriÄŸi</div>
                <p>
                    Sol panelden bir pencereye Ã§ift tÄ±kladÄ±ÄŸÄ±nÄ±zda veya ğŸ” ikonuna bastÄ±ÄŸÄ±nÄ±zda,
                    ilgili pencerenin detaylarÄ± burada aÃ§Ä±lacaktÄ±r.
                </p>
                <p>
                    AyrÄ±ca, Ã¼stteki ğŸ–¥ï¸ ikonuna basarak tam ekran dashboard moduna geÃ§ebilir, 
                    mikrofon ikonuyla da sesli komutlarÄ± baÅŸlatÄ±p durdurabilirsiniz.
                </p>
            </div>
        </div>
    </div>

</div>

<div class="edge-menu left">
    <div class="edge-menu-tab">Sol MenÃ¼</div>
    <div class="edge-menu-content">
        <button>ğŸ  Ana Sayfa</button>
        <button>ğŸ“‚ Dosya GeÃ§miÅŸi</button>
        <button>ğŸ‘¨â€âš•ï¸ KonsÃ¼ltasyonlar</button>

        <!-- AÃ§Ä±lÄ±r Ayarlar menÃ¼sÃ¼ -->
        <button id="settingsMainBtn" type="button">âš™ï¸ Ayarlar â–¾</button>
        <div id="settingsSubmenu" class="settings-submenu">
            <button type="button" onclick="goToCustomize()">ğŸ§© Ã–zelleÅŸtir</button>
            <!-- Ä°lerde buraya baÅŸka alt ayarlar da ekleyebiliriz -->
        </div>
    </div>
</div>


<div class="edge-menu right">
    <div class="edge-menu-tab">HÄ±zlÄ± Ä°ÅŸlem</div>
    <div class="edge-menu-content">
        <button>ğŸ§¾ Yeni ReÃ§ete</button>
        <button>ğŸ§ª Yeni Tetkik</button>
        <button>ğŸ©» GÃ¶rÃ¼ntÃ¼leme Ä°ste</button>
        <button>ğŸ“… Randevu PlanlayÄ±cÄ±</button>
        <button>ğŸ“Š Ä°statistikler</button>
        <button>ğŸ“„ Rapor ÅablonlarÄ±</button>
        <button>âœ‰ï¸ KonsÃ¼ltasyon</button>
        <button>âš™ï¸ Ayarlar</button>
    </div>
</div>

<div id="mobile-menu-modal" class="menu-modal">
    <div class="menu-modal-content">
        <div class="menu-header">
            <h3>HÄ±zlÄ± Ä°ÅŸlemler</h3>
            <button id="closeMobileMenu" class="close-btn">&times;</button>
        </div>
        <div class="menu-group">
            <h4>ReÃ§ete ve Tetkikler</h4>
            <button>ğŸ’Š Yeni ReÃ§ete</button>
            <button>ğŸ§ª Yeni Tetkik</button>
            <button>ğŸ©» GÃ¶rÃ¼ntÃ¼leme Ä°ste</button>
        </div>
        <div class="menu-group">
            <h4>Hasta Ä°ÅŸlemleri</h4>
            <button>ğŸ“‚ Dosya GeÃ§miÅŸi</button>
            <button>ğŸ‘¨â€âš•ï¸ KonsÃ¼ltasyonlar</button>
            <button>ğŸ“… Randevu PlanlayÄ±cÄ±</button>
        </div>
        <div class="menu-group">
            <h4>Sistem</h4>
            <button>ğŸ“Š Ä°statistikler</button>
            <button>ğŸ“„ Rapor ÅablonlarÄ±</button>
<!-- AÃ§Ä±lÄ±r Ayarlar + alt menÃ¼ -->
<button id="mobileSettingsMainBtn" type="button" title="Ayarlar">âš™ï¸ Ayarlar â–¾</button>
<div id="mobileSettingsSubmenu" class="settings-submenu">
    <button type="button" onclick="goToCustomize()">ğŸ§© Ã–zelleÅŸtir</button>
</div>
        </div>
    </div>
</div>

<div id="card-detail-modal" class="detail-modal">
    <div class="detail-modal-header">
        <button id="closeDetailModalBtn" class="back-btn">â¬…</button>
        <h3 id="detail-modal-title">Pencere AdÄ±</h3>
    </div>
    <div id="detail-modal-content" class="detail-modal-content"></div>
</div>

<script>
const mainWrapper = document.getElementById('mainWrapper');
const solPanel    = document.getElementById('solPanel');
const sagPanel    = document.getElementById('sagPanel');
const hastaOzet   = document.getElementById('hasta-ozet');
const sagIcerik   = document.getElementById('sag-icerik-icerik');
const hizliBar    = document.getElementById('hizli-aksiyon-bar');

const fullscreenBtn = document.getElementById('fullscreenToggleBtn');
const hizliBarToggleBtn = document.getElementById('hizliBarToggleBtn'); 
const leftAllExpandBtn = document.getElementById('leftAllExpandBtn');
const micBtn        = document.getElementById('mikrofonToggleBtn');
const mobileMenuToggleBtn = document.getElementById('mobileMenuToggle');
const mobileMenuModal = document.getElementById('mobile-menu-modal');
const closeMobileMenuBtn = document.getElementById('closeMobileMenu');

const settingsMainBtn = document.getElementById('settingsMainBtn');
const settingsSubmenu = document.getElementById('settingsSubmenu');
let settingsMenuOpen = false;

const mobileSettingsMainBtn = document.getElementById('mobileSettingsMainBtn');
const mobileSettingsSubmenu = document.getElementById('mobileSettingsSubmenu');
let mobileSettingsMenuOpen = false;


const mobileDetailModal = document.getElementById('card-detail-modal');
const detailModalTitle  = document.getElementById('detail-modal-title');
const detailModalContent = document.getElementById('detail-modal-content');
const closeDetailModalBtn = document.getElementById('closeDetailModalBtn');

const inceSplitter = document.getElementById("inceSplitter");
const MIN_INCE_WIDTH = 220;
const STORAGE_KEY_INCE_WIDTH = "incePanelWidthPx";


let solHidden = false;
let micActive = false;
let dashboardMode = false;
let initialViewApplied = false;
let fullscreenRequestedByButton = false;
let solAllExpanded= false;

let defaultSagIcerikHTML = sagIcerik ? sagIcerik.innerHTML : '';
let lastRightPanelHTML = defaultSagIcerikHTML;

function resizeHastaBilgisiFrame() {
    try {
        // Hem saÄŸ panelde hem sol panelde olabilecek TÃœM hastaBilgisi iframe'lerini yakala
        const frames = document.querySelectorAll(
            'iframe#hastaBilgisiFrame, iframe[src*="hastabilgisi"]'
        );

        frames.forEach(frame => {
            let attempts = 0;

            const doResize = () => {
                const doc  = frame.contentDocument || (frame.contentWindow && frame.contentWindow.document);
                if (!doc) return;

                const body = doc.body;
                if (!body) return;

                const newHeight = body.scrollHeight;
                if (newHeight && frame._lastHBHeight !== newHeight) {
                    frame.style.height = newHeight + "px";
                    frame._lastHBHeight = newHeight;
                }

                // Ä°Ã§erik zamanla ÅŸiÅŸebildiÄŸi iÃ§in (Kendo, font vs.),
                // birkaÃ§ kez daha yÃ¼kseklik Ã¶lÃ§elim
                if (attempts++ < 10) {           // yaklaÅŸÄ±k 3 saniye kadar
                    setTimeout(doResize, 300);    // her 300 ms'de bir tekrar dene
                }
            };

            doResize();
        });
    } catch (e) {
        console.error("hastaBilgisiFrame resize hatasÄ±:", e);
    }
}


// Ekran modu: 'mobile' | 'tablet' | 'desktop'
function getViewportMode() {
    const w = window.innerWidth;
    if (w <= 768) return 'mobile';
    if (w <= 1024) return 'tablet';
    return 'desktop';
}

let currentViewportMode = getViewportMode();


let recognition = null;
const speechSupported = 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;
const voiceBox = document.getElementById('voice-command-box');
const voiceText = document.getElementById('voice-command-text');

function showVoiceCommand(text) {
    if (!voiceBox || !voiceText) return;
    voiceText.textContent = text || '-';
}

// ğŸ”¹ Ortak helper: sol panelde ilgili pencereyi bulup saÄŸda aÃ§
function openPanelByType(partOfDataTuru) {
    if (!solPanel) return false;

    const hedef = partOfDataTuru.toLowerCase();
    const kutular = solPanel.querySelectorAll('.kutu');

    for (const k of kutular) {
        const tur = (k.dataset.turu || '').toLowerCase();
        if (tur.includes(hedef)) {
            // Sol panel kapalÄ±ysa aÃ§
            if (solHidden) toggleLeftPanel();
            // SaÄŸ panelde geniÅŸ olarak aÃ§
            openCardInRightPanel(k);
            return true;
        }
    }
    return false;
}


/* === HIZLI ERÄ°ÅÄ°M BUTONLARI (2. SATIR) â€“ CONFIG'E GÃ–RE === */

const QUICK_ACTIONS = [
    { id: 'qa-barkod',    icon: 'ğŸ“·', title: 'Barkod / Karekod Okut' },
    { id: 'qa-recete',    icon: 'ğŸ’Š', title: 'Ä°laÃ§ ReÃ§etesi' },
    { id: 'qa-not',       icon: 'ğŸ“', title: 'Hasta Notu Ekle' },
    { id: 'qa-rapor',     icon: 'ğŸ“„', title: 'Rapor OluÅŸtur' },
    { id: 'qa-lab',       icon: 'ğŸ§ª', title: 'Laboratuvar Ä°stem' },
    { id: 'qa-radyoloji', icon: 'ğŸ©»', title: 'Radyoloji Ä°stem' },
    { id: 'qa-enabiz',    icon: 'ğŸŒ', title: 'e-NabÄ±z Klinik Bilgi' },
    { id: 'qa-risk',      icon: 'âš ï¸', title: 'Risk/UyarÄ±' },
    { id: 'qa-acil',      icon: 'ğŸš¨', title: 'Acil Durum' },
    { id: 'qa-takvim',    icon: 'ğŸ“…', title: 'Takvim / Randevu' }
];

function getDefaultQuickConfig() {
    return QUICK_ACTIONS.map(a => ({
        id: a.id,
        enabled: true
    }));
}

// drhastabasiozellestir.html'in yazacaÄŸÄ± yapÄ±:
// - Eski basit format: [ {id, enabled}, ... ]
// - Yeni Ã§oklu format:
//   {
//     desktop: { items:[...], align:'left|center|right' },
//     tablet:  { items:[...], align:'...' },
//     mobile:  { items:[...], align:'...' }
//   }

// Gelen diziyi normalize et (bilinmeyen id'leri at, eksik olanlarÄ± sona ek)
function normalizeQuickItems(arr) {
    const knownIds = new Set(QUICK_ACTIONS.map(a => a.id));
    const result = [];

    for (const item of arr || []) {
        if (!item || typeof item.id !== 'string') continue;
        if (!knownIds.has(item.id)) continue;

        result.push({
            id: item.id,
            enabled: item.enabled !== false
        });
    }

    const existingIds = new Set(result.map(r => r.id));
    for (const a of QUICK_ACTIONS) {
        if (!existingIds.has(a.id)) {
            result.push({ id: a.id, enabled: true });
        }
    }

    return result;
}

function loadQuickConfigForMode() {
    const DEFAULT_ALIGN = 'right';

    const defaultResult = () => ({
        items: getDefaultQuickConfig(),
        align: DEFAULT_ALIGN
    });

    const raw = localStorage.getItem('quickAccessConfig');
    if (!raw) return defaultResult();

    let parsed;
    try {
        parsed = JSON.parse(raw);
    } catch {
        return defaultResult();
    }

    // Eski tek dizi formatÄ±: [ {id, enabled}, ... ]
    if (Array.isArray(parsed)) {
        return {
            items: normalizeQuickItems(parsed),
            align: DEFAULT_ALIGN
        };
    }

    // Yeni Ã§oklu profil formatÄ±
    if (parsed && typeof parsed === 'object') {
        const mode = typeof getViewportMode === 'function'
            ? getViewportMode()
            : 'desktop';

        // Ä°lgili modu seÃ§, yoksa desktop â†’ tablet â†’ mobile fallback
        let block = parsed[mode] ?? parsed.desktop ?? parsed.tablet ?? parsed.mobile;

        // BazÄ± eski kayÄ±tlarda hala direkt dizi olabilir
        if (Array.isArray(block)) {
            return {
                items: normalizeQuickItems(block),
                align: DEFAULT_ALIGN
            };
        }

        // Beklenen yeni format: { items:[...], align:'...' }
        if (block && typeof block === 'object') {
            const itemsArray = Array.isArray(block.items) ? block.items : [];
            let alignValue = (block.align || DEFAULT_ALIGN).toString().toLowerCase();


            if (!['left', 'center', 'right'].includes(alignValue)) {
                alignValue = DEFAULT_ALIGN;
            }

            return {
                items: normalizeQuickItems(itemsArray),
                align: alignValue,
		barVisible: (typeof block.barVisible === 'boolean') ? block.barVisible : true
            };
        }
    }

    return defaultResult();
}

function buildQuickActionsBar() {
    const bar = document.getElementById('hizli-aksiyon-bar');
    if (!bar) return;

    const cfg = loadQuickConfigForMode();
    const configItems = cfg.items || [];
    const align = cfg.align || 'right';

if (cfg.barVisible === false) {
    bar.style.display = 'none';   // Bar gizleniyor
} else {
    bar.style.display = 'flex';   // Bar gÃ¶steriliyor
}


    const defMap = new Map(QUICK_ACTIONS.map(a => [a.id, a]));

    // Hizalama: sola / ortaya / saÄŸa
    let jc = 'flex-end';          // varsayÄ±lan: saÄŸ
    if (align === 'left') {
        jc = 'flex-start';
    } else if (align === 'center') {
        jc = 'center';
    }
    bar.style.justifyContent = jc;

    // Eski statik butonlarÄ± temizle
    bar.innerHTML = '';

    // Sadece "enabled" olanlarÄ± sÄ±raya gÃ¶re ekle
    configItems.forEach(item => {
        if (!item || item.enabled === false) return;

        const def = defMap.get(item.id);
        if (!def) return;

        const btn = document.createElement('button');
        btn.className = 'icon-btn2';
        btn.title = def.title;
        btn.dataset.actionId = def.id;
        btn.textContent = def.icon;

        bar.appendChild(btn);
    });
}


/* === SOL PANEL KONFÄ°GÃœRASYONU â€“ AYAR SAYFASIYLA AYNI MANTIÄI KULLAN === */

const SOL_PANEL_ALL_IDS = [
    'panel-hasta-bilgisi',
    'panel-muayene',
    'panel-teshis',
    'panel-laboratuvar',
    'panel-radyoloji',
    'panel-recete',
    'panel-asi',
    'panel-notlar',
    'panel-randevu'
];

function loadSolPanelConfigNormalized() {
    const STORAGE_KEY = 'solPanelConfig';
    const mode = getViewportMode ? getViewportMode() : 'desktop';

    const defaultConfig = () =>
        SOL_PANEL_ALL_IDS.map((id, index) => ({
            id,
            enabled: true,
            isDefault: index === 0
        }));

    try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaultConfig();

        const parsed = JSON.parse(raw);

        let arr = null;

        if (Array.isArray(parsed)) {
            // ğŸ”¹ Eski format: tek set â†’ tÃ¼m cihazlar iÃ§in aynÄ±
            arr = parsed;
        } else if (parsed && typeof parsed === 'object') {
            // ğŸ”¹ Yeni format: { desktop: [...], tablet: [...], mobile: [...] }
            arr =
                parsed[mode] ||
                parsed.desktop ||
                parsed.tablet ||
                parsed.mobile ||
                null;
        }

        if (!Array.isArray(arr)) return defaultConfig();

        const knownIds = new Set(SOL_PANEL_ALL_IDS);
        const result = [];

        // KayÄ±tlÄ± olanlarÄ± sÄ±rayla ekle (sadece bilinen ID'ler)
        for (const item of arr) {
            if (!item || typeof item.id !== 'string') continue;
            if (!knownIds.has(item.id)) continue;

            result.push({
                id: item.id,
                enabled: item.enabled !== false,
                isDefault: !!item.isDefault
            });
        }

        // Eksik ID varsa sona ekle
        const existingIds = new Set(result.map(r => r.id));
        for (const id of SOL_PANEL_ALL_IDS) {
            if (!existingIds.has(id)) {
                result.push({
                    id,
                    enabled: true,
                    isDefault: false
                });
            }
        }

        // En az bir â€œdefault & enabledâ€ olsun
        let defaultIndex = result.findIndex(r => r.isDefault && r.enabled);
        if (defaultIndex === -1) {
            const firstEnabled = result.findIndex(r => r.enabled);
            if (firstEnabled !== -1) {
                result[firstEnabled].isDefault = true;
            }
        }

        return result;
    } catch (e) {
        console.error('solPanelConfig yÃ¼klenirken hata:', e);
        return defaultConfig();
    }
}

/* === SOL PANEL Ã–ZELLEÅTÄ°RME AYARLARINI UYGULA === */

function applySolPanelConfig() {
    const solPanelEl = document.getElementById('solPanel');
    if (!solPanelEl) return;

    const config = loadSolPanelConfigNormalized();
    if (!config || !config.length) return;

    const isMobile = window.matchMedia("(max-width: 768px)").matches;

    // 1) SÄ±raya gÃ¶re kutularÄ± yeniden diz
    config.forEach(item => {
        if (!item || !item.id) return;
        const el = document.getElementById(item.id);
        if (el && el.parentElement === solPanelEl) {
            solPanelEl.appendChild(el);
        }
    });

    // 2) GÃ¶rÃ¼nÃ¼rlÃ¼k (GÃ–RÃœNSÃœN sÃ¼tunu)
    config.forEach(item => {
        if (!item || !item.id) return;
        const el = document.getElementById(item.id);
        if (el && el.parentElement === solPanelEl) {
            el.style.display = item.enabled === false ? 'none' : '';
        }
    });

    // 3) AÃ§Ä±k / kapalÄ± durum
    const openIds = getOpenPanelIdsFromConfig();

    config.forEach(item => {
        if (!item || !item.id) return;
        const el = document.getElementById(item.id);
        if (!el || el.parentElement !== solPanelEl) return;

        const headerEl = el.querySelector('.kutu-baslik');
        const toggleBtn = headerEl ? headerEl.querySelector('.kutu-toggle-btn') : null;

        if (openIds.includes(item.id)) {
            // AÃ‡IK
            el.classList.add('full');
            if (isMobile) {
                el.classList.add('active');
            } else {
                el.classList.add('expanded');
                el.classList.remove('collapsed');
            }
            if (toggleBtn) toggleBtn.textContent = 'â–¾';
        } else {
            // KAPALI
            el.classList.remove('full');
            if (isMobile) {
                el.classList.remove('active');
            } else {
                el.classList.remove('expanded');
                el.classList.add('collapsed');
            }
            if (toggleBtn) toggleBtn.textContent = 'â–¸';
        }
    });
}



/* === AÃ‡ILIÅTA SAÄ PANELE HANGÄ° PENCERE GELECEK? === */

function getDefaultPanelIdFromConfig() {
    const config = loadSolPanelConfigNormalized();
    if (!config || !config.length) {
        return 'panel-hasta-bilgisi';
    }

    // Ã–nce hem enabled hem isDefault olanÄ± bul
    let chosen = config.find(c => c.enabled && c.isDefault);

    // Yoksa ilk enabled olanÄ± al
    if (!chosen) {
        chosen = config.find(c => c.enabled);
    }

    return chosen ? chosen.id : 'panel-hasta-bilgisi';
}

function getOpenPanelIdsFromConfig() {
    const STORAGE_KEY = 'solPanelConfig';
    const mode = getViewportMode ? getViewportMode() : 'desktop';

    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return [];

    try {
        const parsed = JSON.parse(raw);

        let cfgArray = null;

        if (Array.isArray(parsed)) {
            // Eski tek set format
            cfgArray = parsed;
        } else if (parsed && typeof parsed === 'object') {
            cfgArray =
                parsed[mode] ||
                parsed.desktop ||
                parsed.tablet ||
                parsed.mobile ||
                null;
        }

        if (!Array.isArray(cfgArray)) return [];

        const hasAnyOpenFlag = cfgArray.some(c =>
            c && (
                typeof c.acikDurum !== 'undefined' ||
                typeof c.acik      !== 'undefined' ||
                typeof c.open      !== 'undefined' ||
                typeof c.isOpen    !== 'undefined'
            )
        );

        if (!hasAnyOpenFlag) {
            return [];
        }

        const openIds = cfgArray
            .filter(c =>
                c &&
                c.enabled !== false && (
                    c.acikDurum ||
                    c.acik ||
                    c.open ||
                    c.isOpen
                )
            )
            .map(c => c.id)
            .filter(Boolean);

        return openIds;
    } catch (e) {
        console.error('getOpenPanelIdsFromConfig hata:', e);
        return [];
    }
}

function getDefaultOpenPanelIdFromConfig() {
    const raw = localStorage.getItem('solPanelConfig');
    if (!raw) return null;

    try {
        const cfg = JSON.parse(raw);
        if (!Array.isArray(cfg)) return null;

        const item = cfg.find(c =>
            c &&
            c.enabled !== false &&          // GÃ–RÃœNSÃœN = true
            c.isDefault === true &&         // DEFAULT = true
            (
                c.acikDurum ||              // AÃ‡IK DURUM sÃ¼tunlarÄ±ndan biri
                c.acik ||
                c.open ||
                c.isOpen
            )
        );

        return item && item.id ? item.id : null;
    } catch (e) {
        console.error('solPanelConfig parse hatasÄ± (default aÃ§Ä±k):', e);
        return null;
    }
}

function handleVoiceCommand(cmd) {
    const text = cmd.toLowerCase();
	
    if (text.includes('geri dÃ¶n') || text.includes('geri don') || text.includes('geri')  || text.includes('dÃ¶n') || text.includes('don')) {
        // EÄŸer mobil detay modalÄ± aÃ§Ä±ksa, geri butonuna basÄ±lmÄ±ÅŸ gibi yap
        if (mobileDetailModal && mobileDetailModal.classList.contains('active')) {
            if (closeDetailModalBtn) {
                closeDetailModalBtn.click();   // aynen kullanÄ±cÄ± oka basmÄ±ÅŸ gibi
            } else {
                // emniyet: buton yoksa direkt fonksiyonu Ã§aÄŸÄ±r
                if (typeof closeCardDetailModal === 'function') {
                    closeCardDetailModal();
                }
            }
        }
        return; // Bu komutu iÅŸledik, alttaki diÄŸer if'lere geÃ§mesin
    }


    if (text.includes('dashboard aÃ§') || text.includes('deÅŸbord aÃ§') || text.includes('daÅŸbord aÃ§') || text.includes('full ekran') || text.includes('deÄŸiÅŸport aÃ§')) {
        applyDashboardLayout(true);
    } else if (text.includes('dashboard kapat') || text.includes('ekranÄ± kapat')) {
        applyDashboardLayout(false);
    } else if (text.includes('sol panel kapat') || text.includes('sol paneli kapat') || text.includes('paneli kapat')) {
        if (!solHidden) toggleLeftPanel();
    } else if (text.includes('sol panel aÃ§')  || text.includes('sol paneli aÃ§') || text.includes('paneli aÃ§')) {
        if (solHidden) toggleLeftPanel();
// ğŸ”¸ Pencereler
    } else if (text.includes('hasta bilgisi') || text.includes('hasta kartÄ±') || text.includes('hasta')) {
        openPanelByType('hasta-bilgisi');

    } else if (text.includes('muayene')) {
        openPanelByType('muayene');

    } else if (text.includes('teÅŸhis') || text.includes('tanÄ±') || text.includes('tani')) {
        openPanelByType('teshis');

    } else if (text.includes('laboratuvar') || text.includes('tahlil') || text.includes('lab')) {
        openPanelByType('laboratuvar');

    } else if (text.includes('radyoloji') || text.includes('film') || text.includes('bt') || text.includes('mr')) {
        openPanelByType('radyoloji');

    } else if (text.includes('reÃ§ete') || text.includes('ilaÃ§')) {
        openPanelByType('recete');

    } else if (text.includes('aÅŸÄ±') || text.includes('baÄŸÄ±ÅŸÄ±klama')) {
        openPanelByType('asi');

    } else if (text.includes('notlar') || text.includes('plan')) {
        openPanelByType('notlar');

    } else if (text.includes('randevu') || text.includes('kontrol')) {
        openPanelByType('randevu');
    }
}    // Buraya ileride yeni komutlar ekleyebiliriz.

function startRecognition() {

    if (!speechSupported) {
        alert('TarayÄ±cÄ±nÄ±z sesli komut (SpeechRecognition) Ã¶zelliÄŸini desteklemiyor.');
        micActive = false;
        return;
    }
    if (!recognition) {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SR();
        recognition.lang = 'tr-TR';
        recognition.continuous = true;
        recognition.interimResults = false;

recognition.onstart = function () {
        micBtn.style.backgroundColor = '#2ecc71';  // yeÅŸil
        micBtn.style.color = '#fff';
        micBtn.style.border = '1px solid #27ae60';
    };

recognition.onend = function () {

            // EÄŸer micActive hÃ¢lÃ¢ true ise â†’ otomatik yeniden baÅŸlat
            if (micActive) {
                try {
                    recognition.start();
                } catch(e) {
                    console.error(e);
                }
            } else {
                // KullanÄ±cÄ± mikrofonu kapattÄ±ysa â†’ eski gÃ¶rÃ¼nÃ¼me dÃ¶n
                micBtn.style.backgroundColor = 'inherit';
                micBtn.style.color = '#000';
                micBtn.style.border = 'none';
                micBtn.title = 'Mikrofonu BaÅŸlat';
            }
        };

        recognition.onresult = (event) => {
            const lastResult = event.results[event.results.length - 1];
            if (!lastResult || !lastResult[0]) return;
            const transcript = lastResult[0].transcript.trim();
            console.log('Sesli komut:', transcript);
            showVoiceCommand(transcript);
            handleVoiceCommand(transcript);
        };

        recognition.onerror = (event) => {
            console.error('SpeechRecognition error:', event.error);
            // Hata olduÄŸunda otomatik kapatalÄ±m
            micActive = false;
            micBtn.style.backgroundColor = 'inherit';
            micBtn.style.color = '#000';
            micBtn.title = 'Mikrofonu BaÅŸlat';
            showVoiceCommand('Hata: ' + event.error);
        };

    }

    try {
        recognition.start();
        showVoiceCommand('Dinleniyor...');
    } catch (e) {
        console.error('Recognition start hatasÄ±:', e);
    }
}

function stopRecognition() {
    if (recognition) {
        micActive = false;
        try {
            recognition.stop();
        } catch(e) {
            console.error(e);
        }
        showVoiceCommand('-');
    }
}



function calculateHeaderHeight() {
    let height = 0;
    if (hastaOzet && getComputedStyle(hastaOzet).display !== 'none') {
        height += hastaOzet.offsetHeight;
    }
    if (hizliBar && getComputedStyle(hizliBar).display !== 'none') {
        height += hizliBar.offsetHeight;
    }
    return height;
}

function getLeftPanelWidth() {
    const isVisible = solPanel && getComputedStyle(solPanel).display !== 'none';
    if (window.matchMedia("(max-width: 768px)").matches) return 0;
    if (!isVisible || solHidden) return 0;
    if (dashboardMode) return 0;
    return solPanel.offsetWidth;
}

function updateFixedHeaderPosition() {
    const offset = getLeftPanelWidth();
    if (hastaOzet) hastaOzet.style.left = offset + 'px';
    if (hizliBar) hizliBar.style.left = offset + 'px';
}

function setPanelOffsets() {
    const totalHeaderHeight = calculateHeaderHeight();
    const solPanelPadding = 10; 
    const isMobile = window.matchMedia("(max-width: 768px)").matches;

    if (!isMobile) {
        // ğŸ’» MasaÃ¼stÃ¼ / tablet: SAYFA SCROLL YOK, sadece paneller scroll
        document.body.style.overflow = 'hidden';

        if (mainWrapper) {
            mainWrapper.style.marginTop   = '0';
            mainWrapper.style.height      = '100vh';
            mainWrapper.style.minHeight   = '100vh';
            mainWrapper.style.flexDirection =
		  document.body.classList.contains('ince-right') ? 'row-reverse' : 'row';
        }

        if (solPanel) {
            solPanel.style.marginTop   = '0';
            solPanel.style.paddingTop  = solPanelPadding + 'px';
            // Sol panel kendi iÃ§inde scroll yapsÄ±n diye sabit yÃ¼kseklik
            solPanel.style.height      = '100vh';
        }

        if (sagPanel) {
	    //sagPanel.style.marginTop   = totalHeaderHeight + 'px';
            // SaÄŸ panel yÃ¼ksekliÄŸi: headerâ€™lar Ã§Ä±ktÄ±ktan sonra kalan alan
            const h = `calc(100vh - ${totalHeaderHeight}px)`;
            sagPanel.style.height      = h;
            sagPanel.style.minHeight   = h;
        }
    } else {
        // ğŸ“± Mobil: sayfa normal scroll, paneller alt alta
        document.body.style.overflow = 'auto';

        if (mainWrapper) {
            mainWrapper.style.marginTop   = totalHeaderHeight + 'px';
            mainWrapper.style.height      = 'auto';
            mainWrapper.style.minHeight   = '100vh';
            mainWrapper.style.flexDirection = 'column';
        }

        if (solPanel) {
            solPanel.style.marginTop   = '0';
            solPanel.style.height      = 'auto';
            solPanel.style.paddingTop  = '8px';
        }

        if (sagPanel) {
            sagPanel.style.marginTop   = '0';
            sagPanel.style.height      = 'auto';
            sagPanel.style.minHeight   = '0';
        }
    }
}

/* Mobil detay modalÄ± */
function openCardDetailModal(kutu) {
    if (!mobileDetailModal || !detailModalContent || !detailModalTitle) return;
    const titleText = kutu.querySelector('.kutu-baslik').textContent;
    detailModalTitle.textContent = titleText;
    
    detailModalContent.innerHTML = '';
    const clone = kutu.cloneNode(true);
    const ac = clone.querySelector('.ac-icon');
    if (ac) ac.remove();
    clone.classList.add('active');
    // Modal iÃ§inde aÃ§/kapa okunu ve bÃ¼yÃ¼teci kaldÄ±r (gereksiz)
    clone.querySelectorAll('.kutu-toggle-btn, .ac-icon').forEach(el => el.remove()); 
    
    clone.querySelectorAll('.muayene-ozet').forEach(td => {
        td.style.display = 'block';
        td.style.webkitLineClamp = 'unset';
    });
    if (kutu.dataset.turu === 'laboratuvar') {
        const labTbody = clone.querySelector('table tbody');
        if (labTbody) {
             labTbody.style.maxHeight = 'none';
             labTbody.style.overflowY = 'visible';
             labTbody.style.display = 'table-row-group';
        }
    }
    
    detailModalContent.appendChild(clone);
    mobileDetailModal.classList.add('active');
    mobileDetailModal.scrollTop = 0;
}
function closeCardDetailModal() {
    if (mobileDetailModal) {
        mobileDetailModal.classList.remove('active');
    }
}

/* SaÄŸ panel tek kart detay */
function openCardInRightPanel(kutu) {
    // Mobilde yine modal'Ä± kullan
    if (window.matchMedia("(max-width: 768px)").matches) {
        openCardDetailModal(kutu);
        return;
    }
    if (!sagIcerik) return;

    const baslik = kutu.querySelector('.kutu-baslik')
        ? kutu.querySelector('.kutu-baslik').innerText
        : 'Detay';

    sagIcerik.innerHTML = '';

    const yeniKutu = document.createElement('div');
    yeniKutu.className = 'kutu';

    const yeniBaslik = document.createElement('div');
    yeniBaslik.className = 'kutu-baslik';
    yeniBaslik.textContent = baslik + ' (Detay)';
    yeniKutu.appendChild(yeniBaslik);

    // Kart iÃ§eriÄŸini klonla
    const icerikKlon = kutu.cloneNode(true);
    icerikKlon.classList.remove('active');

    // Sol paneldeki bÃ¼yÃ¼teÃ§ ve baÅŸlÄ±ÄŸÄ± temizle
    const ikon = icerikKlon.querySelector('.ac-icon');
    if (ikon) ikon.remove();
    const baslikElemani = icerikKlon.querySelector('.kutu-baslik');
    if (baslikElemani) baslikElemani.remove();

    // SaÄŸ panelde MUAYENE Ã¶zetleri tamamen aÃ§Ä±k olsun
    icerikKlon.querySelectorAll('.muayene-ozet').forEach(td => {
        td.style.display = 'block';
        td.style.webkitLineClamp = 'unset';
        td.style.overflow = 'visible';
    });

    // SaÄŸ paneldeki TÃœM tablolar (lab, teÅŸhis, reÃ§ete vb.) iÃ§in
    // satÄ±r kÄ±sÄ±tlarÄ± ve iÃ§ scroll'u kaldÄ±r
    icerikKlon.querySelectorAll('table tbody').forEach(tbody => {
        tbody.style.maxHeight = 'none';
        tbody.style.overflowY = 'visible';
        tbody.style.display = 'table-row-group';
    });

    // Klonun iÃ§ini yeni kutuya taÅŸÄ±
    while (icerikKlon.firstChild) {
        yeniKutu.appendChild(icerikKlon.firstChild);
    }

    sagIcerik.appendChild(yeniKutu);
    lastRightPanelHTML = sagIcerik.innerHTML;

// ğŸ”¹ Hasta bilgisi saÄŸ tarafa aÃ§Ä±ldÄ±ÄŸÄ±nda da iframe yÃ¼ksekliÄŸini gÃ¼ncelle
    resizeHastaBilgisiFrame();
}


/* Dashboard iÃ§in kutu klonu â€“ bÃ¼yÃ¼teÃ§ korunuyor */
function cloneKutuForRightPanel(kutu) {
    const clone = kutu.cloneNode(true);

    clone.querySelectorAll('.muayene-ozet').forEach(td => {
        td.style.display = 'block';
        td.style.webkitLineClamp = 'unset';
    });

    if (kutu.dataset.turu === 'laboratuvar') {
        const labTbody = clone.querySelector('table tbody');
        if (labTbody) {
            labTbody.style.maxHeight = 'none';
            labTbody.style.overflowY = 'visible';
            labTbody.style.display = 'table-row-group';
        }
    }

    // Hasta Bilgisi kartÄ± dashboard'a kopyalanÄ±rken,
    // ikinci bir 'hastaBilgisiFrame' id'si olmasÄ±n, onload Ã§alÄ±ÅŸmasÄ±n
    if (kutu.id === 'panel-hasta-bilgisi') {
        const iframe = clone.querySelector('iframe');
        if (iframe) {
            iframe.removeAttribute('id');
            iframe.removeAttribute('onload');
        }
    }

    return clone;


}

/* SaÄŸ panel dashboard doldur â€“ dashboard kartÄ±ndaki bÃ¼yÃ¼tec tÄ±klanÄ±nca detay aÃ§ */
function showAllCardsInRightPanelDashboard() {
    if (!sagIcerik || !solPanel) return;

    sagIcerik.innerHTML = '';
    const grid = document.createElement('div');
    grid.className = 'dashboard-grid';

    const kutular = solPanel.querySelectorAll('.kutu');
    kutular.forEach((k, index) => {
        const clone = cloneKutuForRightPanel(k);

        const icon = clone.querySelector('.ac-icon');
        if (icon) {
            icon.addEventListener('click', (e) => {
                e.stopPropagation();
                applyDashboardLayout(false);

                const originals = solPanel.querySelectorAll('.kutu');
                const original = originals[index];
                if (original) {
                    openCardInRightPanel(original);
                }
            });
        }

        grid.appendChild(clone);
    });

    sagIcerik.appendChild(grid);
    if (sagPanel) sagPanel.scrollTop = 0;
}

/* Dashboard layout uygulama */
function applyDashboardLayout(active) {
    dashboardMode = active;

    if (window.matchMedia("(max-width: 768px)").matches) {
        return;
    }

    if (active) {

// YENÄ°
        document.body.classList.add('dashboard-mode');

        solPanel.style.display = 'none';
        sagPanel.style.width = '100%';
        solHidden = true;
        showAllCardsInRightPanelDashboard();

        fullscreenBtn.textContent = 'ğŸ“Š';
        fullscreenBtn.title = "Dashboard'u kapat";
    } else {

// YENÄ°
        document.body.classList.remove('dashboard-mode');

        solPanel.style.display = 'flex';
        if (window.matchMedia("(max-width: 1024px)").matches) {
            solPanel.style.width = '35%';
            sagPanel.style.width = '65%';
        } else {
            solPanel.style.width = '25%';
            sagPanel.style.width = '75%';
        }
        solHidden = false;

	if (sagIcerik) {
	    sagIcerik.innerHTML = lastRightPanelHTML || defaultSagIcerikHTML;
	}

        fullscreenBtn.textContent = 'ğŸ–¥ï¸';
        fullscreenBtn.title = 'Tam ekran Dashboard';
    }

    updateFixedHeaderPosition();
    setPanelOffsets();

// Hasta bilgisi iframe yÃ¼ksekliÄŸini viewport deÄŸiÅŸince gÃ¼ncelle
    resizeHastaBilgisiFrame();
}

/* Fullscreen deÄŸiÅŸimi (F11 / ESC dahil) */
function handleFullscreenChange() {
    const isFS = !!document.fullscreenElement;

    if (!isFS) {
        fullscreenRequestedByButton = false;
        applyDashboardLayout(false);
    } else {
        if (fullscreenRequestedByButton) {
            applyDashboardLayout(true);
            fullscreenRequestedByButton = false;
        }
    }
}

/* ğŸ”´ SOL PANEL GÄ°ZLE/GÃ–STER â€“ SADELEÅTÄ°RÄ°LMÄ°Å HALÄ° */
function toggleLeftPanel() {
    // Mobilde sol panel toggle Ã§alÄ±ÅŸma, aynÄ± kalsÄ±n
    if (window.matchMedia("(max-width: 768px)").matches) {
        return;
    }

    // ğŸ”´ Dashboard modu AÃ‡IKKEN ve sol panel gizliyken
    // "Sol paneli gÃ¶ster" butonu = Dashboard'u kapat
    if (dashboardMode && solHidden) {
        applyDashboardLayout(false);
        return;
    }

    // Normal davranÄ±ÅŸ: sadece sol paneli gizle/gÃ¶ster
    if (!solHidden) {
        // Sadece sol paneli gizle, saÄŸ panel tam geniÅŸlik
        solPanel.style.display = 'none';
        sagPanel.style.width = '100%';
        solHidden = true;
    } else {
        // Sol paneli gÃ¶ster, saÄŸ paneli eski oranÄ±na Ã§ek
        solPanel.style.display = 'flex';
        if (window.matchMedia("(max-width: 1024px)").matches) {
            solPanel.style.width = '35%';
            sagPanel.style.width = '65%';
        } else {
            solPanel.style.width = '25%';
            sagPanel.style.width = '75%';
        }
        solHidden = false;
    }

    // Layout ayarlarÄ±
    updateFixedHeaderPosition();
    setPanelOffsets();
    resizeHastaBilgisiFrame();
}


/* AÃ§/Kapa â€“ hem mobil hem desktop iÃ§in ortak */
function toggleAccordion(event) {
    const baslik = event.currentTarget;
    const kutu = baslik.closest('.kutu');
    if (!kutu) return;

    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    const headerEl = kutu.querySelector('.kutu-baslik');
    const toggleBtn = headerEl ? headerEl.querySelector('.kutu-toggle-btn') : null;

    if (isMobile) {
        // Mobil: mevcut akordeon mantÄ±ÄŸÄ±
        kutu.classList.toggle('active');
    } else {
        // Desktop: collapsed / expanded mantÄ±ÄŸÄ±
        if (kutu.classList.contains('expanded')) {
            kutu.classList.remove('expanded');
            kutu.classList.add('collapsed');
        } else {
            kutu.classList.add('expanded');
            kutu.classList.remove('collapsed');
        }
        // Desktopâ€™ta mobil .active class'Ä± gereksiz
        kutu.classList.remove('active');
    }

    // Ok ikonunu gÃ¼ncelle
    if (toggleBtn) {
        const isOpen = isMobile
            ? kutu.classList.contains('active')
            : kutu.classList.contains('expanded');
        toggleBtn.textContent = isOpen ? 'â–¾' : 'â–¸';
    }
}

// Desktop iÃ§in kartÄ± kapat / aÃ§
function setKutuCollapsedDesktop(kutu, collapsed) {
    if (window.matchMedia("(max-width: 768px)").matches) return; // sadece desktop
    if (collapsed) {
        kutu.classList.add('collapsed');
        kutu.classList.remove('expanded');
    } else {
        kutu.classList.add('expanded');
        kutu.classList.remove('collapsed');
    }
}

function toggleKutuDesktop(kutu) {
    if (window.matchMedia("(max-width: 768px)").matches) return; // sadece desktop
    if (kutu.classList.contains('expanded')) {
        setKutuCollapsedDesktop(kutu, true);
    } else {
        setKutuCollapsedDesktop(kutu, false);
    }
}


/* Click handler kurulumlarÄ± â€“ sol panel kartlarÄ± iÃ§in */
function setupClickHandlers() {
    if (!solPanel) return;
    const kutular = solPanel.querySelectorAll('.kutu');

    kutular.forEach(kutu => {
        const icon   = kutu.querySelector('.ac-icon');
        const baslik = kutu.querySelector('.kutu-baslik');
        if (!baslik) return;

        const isMobile = window.matchMedia("(max-width: 768px)").matches;

        // BaÅŸlÄ±ÄŸa aÃ§/kapa oku ekle (yoksa)
        let toggleBtn = baslik.querySelector('.kutu-toggle-btn');
        if (!toggleBtn) {
            toggleBtn = document.createElement('button');
            toggleBtn.type = 'button';
            toggleBtn.className = 'kutu-toggle-btn';
            toggleBtn.textContent = 'â–¸';
            baslik.prepend(toggleBtn);
        }

        // BaÅŸlangÄ±Ã§ durumu
        if (isMobile) {
            const isOpen = kutu.classList.contains('active');
            toggleBtn.textContent = isOpen ? 'â–¾' : 'â–¸';
        } else {
            // Desktop: default tek satÄ±r (collapsed), istenirse full veya expanded yapÄ±labilir
            if (!kutu.classList.contains('collapsed') &&
                !kutu.classList.contains('expanded')) {
                kutu.classList.add('collapsed');
            }
            const isOpen = kutu.classList.contains('expanded');
            toggleBtn.textContent = isOpen ? 'â–¾' : 'â–¸';
            // Mobilde kullanÄ±lan active class'Ä±nÄ± temizle
            kutu.classList.remove('active');
        }

        // SaÄŸ panele detay aÃ§ma (veya mobilde detay modalÄ±)
        const detailHandler = (evt) => {
            if (evt) evt.stopPropagation();
            const mobileNow = window.matchMedia("(max-width: 768px)").matches;

            openCardInRightPanel(kutu);

            if (!mobileNow) {
                // Desktop: saÄŸa alÄ±nca sol panelde tek satÄ±ra kapan
                kutu.classList.add('collapsed');
                kutu.classList.remove('expanded');
                const h = kutu.querySelector('.kutu-baslik .kutu-toggle-btn');
                if (h) h.textContent = 'â–¸';
            }
        };

        // BÃ¼yÃ¼teÃ§: her yerde sadece detayÄ± aÃ§sÄ±n
        if (icon) {
            icon.onclick = detailHandler;
        }

        // BaÅŸlÄ±ÄŸa tÄ±klayÄ±nca (adÄ±n olduÄŸu her yer) aÃ§/kapa â€“ bÃ¼yÃ¼teÃ§ hariÃ§
        baslik.onclick = (e) => {
            if (e.target && e.target.closest('.ac-icon')) {
                // bÃ¼yÃ¼teÃ§â€™e tÄ±klanmÄ±ÅŸsa burayÄ± Ã§alÄ±ÅŸtÄ±rma
                return;
            }
            toggleAccordion({ currentTarget: baslik });
        };

        // Ok butonuna tÄ±klayÄ±nca da aÃ§/kapa (baÅŸlÄ±k clickâ€™ini tetikliyoruz)
        toggleBtn.onclick = (e) => {
            e.stopPropagation();
            toggleAccordion({ currentTarget: baslik });
        };

        // Desktopâ€™ta kartÄ±n tamamÄ±na Ã§ift tÄ±klayÄ±nca saÄŸ panele aÃ§
        kutu.ondblclick = (e) => {
            if (e.target && e.target.closest('.ac-icon')) return;
            detailHandler(e);
        };
    });
}

function toggleHizliBar() {
    if (!hizliBar) return;

    const currentlyHidden = window.getComputedStyle(hizliBar).display === 'none';

    if (currentlyHidden) {
        // BarÄ± gÃ¶ster
        hizliBar.style.display = 'flex';
        if (hizliBarToggleBtn) {
            hizliBarToggleBtn.textContent = 'â¬‡ï¸';
            hizliBarToggleBtn.title = 'HÄ±zlÄ± Aksiyon BarÄ±nÄ± Gizle';
        }
    } else {
        // BarÄ± gizle
        hizliBar.style.display = 'none';
        if (hizliBarToggleBtn) {
            hizliBarToggleBtn.textContent = 'â¬†ï¸';
            hizliBarToggleBtn.title = 'HÄ±zlÄ± Aksiyon BarÄ±nÄ± GÃ¶ster';
        }
    }
}

function handleResizeAndLoad() {
    setupClickHandlers(); // oklar + bÃ¼yÃ¼teÃ§ eventleri

    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    const isTablet = !isMobile && window.matchMedia("(max-width: 1024px)").matches;

    // --- Mobil ---
    if (isMobile) {
	if (mainWrapper) {
            mainWrapper.style.marginTop = '0';
            mainWrapper.style.paddingTop = '0';
    	}
        if (solPanel) {
            solPanel.style.display = 'flex';
            solPanel.style.width   = '100%';
            solPanel.style.flex  = "0 0 auto";
	    solPanel.style.minWidth = '0';
        }
        if (sagPanel) {
            sagPanel.style.display = 'none';
            sagPanel.style.width   = '100%';
            sagPanel.style.flex  = "0 0 auto";
	    sagPanel.style.minWidth = '0';
        }

        updateFixedHeaderPosition();
        setPanelOffsets();
        resizeHastaBilgisiFrame();

        // ğŸ“± Mobilde de â€œilk aÃ§Ä±k kart aktifâ€ kalsÄ±n (eski davranÄ±ÅŸ)
        if (!initialViewApplied) {
            const openIds = getOpenPanelIdsFromConfig();
            const firstId = openIds.length > 0 ? openIds[0] : null;
            const firstCard = firstId ? document.getElementById(firstId) : null;

            if (firstCard) {
                const solPanelEl = document.getElementById('solPanel');
                if (solPanelEl) solPanelEl.querySelectorAll('.kutu').forEach(k => k.classList.remove('active'));
                firstCard.classList.add('active');
            }
            initialViewApplied = true;
        }

        return;
    }

    // --- Desktop/Tablet genel yerleÅŸim ---
    if (dashboardMode) {
        applyDashboardLayout(true);

        updateFixedHeaderPosition();
        setPanelOffsets();
        resizeHastaBilgisiFrame();
        return;
    }

    if (solHidden) {
        if (solPanel) solPanel.style.display = 'none';
        if (sagPanel) {
            sagPanel.style.display = 'block';
            sagPanel.style.width   = '100%';
        }

        updateFixedHeaderPosition();
        setPanelOffsets();
        resizeHastaBilgisiFrame();
        return;
    }

    // Normal mod: sol + saÄŸ yan yana
    if (solPanel) {
        solPanel.style.display = 'flex';
        solPanel.style.width   = isTablet ? '35%' : '25%';
    }
    if (sagPanel) {
        sagPanel.style.display = 'block';
        sagPanel.style.width   = isTablet ? '65%' : '75%';
    }

    // ğŸ”‘ EN SONDA: splitter kaydÄ± (px) varsa uygula (yÃ¼zdeleri ezsin)
    restoreInceWidthIfAny();

    updateFixedHeaderPosition();
    setPanelOffsets();
    resizeHastaBilgisiFrame();

    // âœ… Ä°lk aÃ§Ä±lÄ±ÅŸta config'teki "AÃ§Ä±lÄ±ÅŸta aÃ§Ä±k" pencerelerinden ilkini saÄŸ panele al
    // (eski davranÄ±ÅŸÄ±n aynÄ±sÄ±) :contentReference[oaicite:1]{index=1}
    if (!initialViewApplied) {
        const openIds = getOpenPanelIdsFromConfig();
        const firstId = openIds.length > 0 ? openIds[0] : null;
        const firstCard = firstId ? document.getElementById(firstId) : null;

        if (firstCard) {
            // ğŸ–¥ï¸ PC/Tablet: ilk aÃ§Ä±k pencere saÄŸ panelde gÃ¶rÃ¼nsÃ¼n
            if (typeof openCardInRightPanel === 'function') {
                openCardInRightPanel(firstCard);
            }

            // Solda aynÄ± kart kapalÄ± olsun (bÃ¼yÃ¼teÃ§le saÄŸa alÄ±nmÄ±ÅŸ gibi)
            if (solPanel && firstCard.parentElement === solPanel) {
                firstCard.classList.remove('full', 'active', 'expanded');
                firstCard.classList.add('collapsed');

                const toggleBtn = firstCard.querySelector('.kutu-baslik .kutu-toggle-btn');
                if (toggleBtn) toggleBtn.textContent = 'â–¸';
            }
        }

        initialViewApplied = true;
    }
}

function toggleHizliBar() {
    if (!hizliBar) return;
    const currentDisplay = getComputedStyle(hizliBar).display;
    if (currentDisplay === 'none') {
        hizliBar.style.display = 'flex';
        hizliBar.style.visibility = 'visible';
    } else {
        hizliBar.style.display = 'none';
        hizliBar.style.visibility = 'hidden';
    }
    updateFixedHeaderPosition();
    setPanelOffsets();

// Hasta bilgisi iframe yÃ¼ksekliÄŸini viewport deÄŸiÅŸince gÃ¼ncelle
    resizeHastaBilgisiFrame();
}


function toggleSolPanelFullContent() {
    if (!solPanel) return;

    solAllExpanded = !solAllExpanded;

    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    const kutular = solPanel.querySelectorAll('.kutu');

    kutular.forEach(kutu => {
        const headerEl = kutu.querySelector('.kutu-baslik');
        const toggleBtn = headerEl ? headerEl.querySelector('.kutu-toggle-btn') : null;

        if (solAllExpanded) {
            // TAM AÃ‡
            kutu.classList.add('full');

            if (isMobile) {
                // Mobil: aktif akordeon
                kutu.classList.add('active');
            } else {
                // PC/Tablet: collapsed/expanded mantÄ±ÄŸÄ±
                setKutuCollapsedDesktop(kutu, false); // expanded
            }
        } else {
            // KAPAT
            kutu.classList.remove('full');

            if (isMobile) {
                kutu.classList.remove('active');
            } else {
                setKutuCollapsedDesktop(kutu, true); // collapsed
            }
        }

        // Ok ikonunu gÃ¼ncelle
        if (toggleBtn) {
            const isOpen = isMobile
                ? kutu.classList.contains('active')
                : kutu.classList.contains('expanded');

            toggleBtn.textContent = isOpen ? 'â–¾' : 'â–¸';
        }
    });

    if (leftAllExpandBtn) {
        if (solAllExpanded) {
            leftAllExpandBtn.textContent = 'ğŸ“„';
            leftAllExpandBtn.title = 'Sol panelde tam iÃ§erikleri kapat';
        } else {
            leftAllExpandBtn.textContent = 'ğŸ“œ';
            leftAllExpandBtn.title = 'Sol panelde tÃ¼m iÃ§erikleri gÃ¶ster';
        }
    }
}


function toggleMic() {
    micActive = !micActive;

    if (micActive) {
	micBtn.classList.add('mic-on');
        micBtn.title = 'Mikrofon aÃ§Ä±k';
        startRecognition();
    } else {
	micBtn.classList.remove('mic-on');
        micBtn.title = 'Mikrofon kapalÄ±';
        stopRecognition();
    }
}


function openMobileMenu() {
console.log("after open:", getComputedStyle(mobileMenuModal).display, mobileMenuModal.className);

  if (!mobileMenuModal) return;

  // sadece mobile'da aÃ§ (opsiyonel)
  if (!window.matchMedia("(max-width: 768px)").matches) return;

  mobileMenuModal.classList.add('active');

  // âœ… CSS ne derse desin zorla gÃ¶ster
  mobileMenuModal.style.setProperty('display', 'block', 'important');

  // (garanti) tam ekran overlay
  mobileMenuModal.style.setProperty('position', 'fixed', 'important');
  mobileMenuModal.style.setProperty('inset', '0', 'important');
  mobileMenuModal.style.setProperty('z-index', '20000', 'important');

  document.body.style.overflow = 'hidden';

  console.log("after open:", getComputedStyle(mobileMenuModal).display, mobileMenuModal.className);
}

function closeMobileMenu() {
  if (!mobileMenuModal) return;

  mobileMenuModal.classList.remove('active');
  mobileMenuModal.style.setProperty('display', 'none', 'important');
  document.body.style.overflow = '';
}

if (mobileMenuModal) {
  mobileMenuModal.addEventListener('click', (e) => {
    if (e.target === mobileMenuModal) closeMobileMenu(); // sadece backdrop'a tÄ±klanÄ±nca
  });
}



/* Tam ekran butonu */
if (fullscreenBtn) {
    fullscreenBtn.addEventListener('click', () => {
        const isMobile = window.matchMedia("(max-width: 768px)").matches;

        // ğŸ”¹ MOBÄ°LDE: sadece F11 gibi davransÄ±n (native fullscreen aÃ§/kapat)
        if (isMobile) {
            if (!document.fullscreenElement) {
                // Tam ekran deÄŸilse â†’ tam ekrana geÃ§
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.error("Mobile fullscreen baÅŸlatÄ±lamadÄ±:", err);
                    });
                }
            } else {
                // Zaten tam ekrandaysa â†’ tam ekrandan Ã§Ä±k
                if (document.exitFullscreen) {
                    document.exitFullscreen().catch(err => {
                        console.error("Mobile fullscreen'den Ã§Ä±kÄ±lamadÄ±:", err);
                    });
                }
            }
            return;
        }

        // ğŸ”¹ PC / TABLET: mevcut davranÄ±ÅŸ aynen kalsÄ±n
        if (!document.fullscreenElement) {
            fullscreenRequestedByButton = true;
            document.documentElement.requestFullscreen().catch(err => {
                console.error("Native fullscreen baÅŸlatÄ±lamadÄ±:", err);
                fullscreenRequestedByButton = false;
                applyDashboardLayout(true);
            });
        } else {
            applyDashboardLayout(!dashboardMode);
        }
    });
}


let incePanelState = 'left';
let lastInceNonHidden = 'left';

function setIncePanel(pos) {
    // Mobilde ince panel butonlarÄ± zaten gizli; davranÄ±ÅŸÄ± sabit kalsÄ±n
    if (window.matchMedia("(max-width: 768px)").matches) return;


    if (pos !== 'left' && pos !== 'hidden' && pos !== 'right') return;

    // Dashboard aÃ§Ä±kken kullanÄ±cÄ± left/right isterse: Ã¶nce dashboard'u kapat, sonra uygula
    if (dashboardMode && pos !== 'hidden') {
        applyDashboardLayout(false);
        // applyDashboardLayout(false) zaten setIncePanel(...) Ã§aÄŸÄ±rÄ±r; biz burada tekrar hedefi uygularÄ±z
    }

    // SÄ±nÄ±flarÄ± gÃ¼ncelle (layout yÃ¶nÃ¼ iÃ§in)
    document.body.classList.remove('ince-left', 'ince-right', 'ince-hidden');
    if (pos === 'right') document.body.classList.add('ince-right');
    else if (pos === 'hidden') document.body.classList.add('ince-hidden');
    else document.body.classList.add('ince-left');

    incePanelState = pos;
    if (pos !== 'hidden') lastInceNonHidden = pos;

    if (pos === 'hidden') {
        solPanel.style.display = 'none';
        sagPanel.style.width = '100%';
        solHidden = true;
    } else {
        solPanel.style.display = 'flex';
        if (window.matchMedia("(max-width: 1024px)").matches) {
            solPanel.style.width = '35%';
            sagPanel.style.width = '65%';
        } else {
            solPanel.style.width = '25%';
            sagPanel.style.width = '75%';
        }
        solHidden = false;

const saved = localStorage.getItem(STORAGE_KEY_INCE_WIDTH);
if (saved) {
    applyInceWidth(parseInt(saved, 10));
}

    }

    updateFixedHeaderPosition();
    setPanelOffsets();
    resizeHastaBilgisiFrame();
}


/* Event baÄŸlamalarÄ± */

document.getElementById("inceLeftBtn").onclick  = () => setIncePanel("left");
document.getElementById("inceHideBtn").onclick  = () => setIncePanel("hidden");
document.getElementById("inceRightBtn").onclick = () => setIncePanel("right");


if (hizliBarToggleBtn) {             
    hizliBarToggleBtn.addEventListener('click', toggleHizliBar);
}

if (leftAllExpandBtn) {
    leftAllExpandBtn.addEventListener('click', toggleSolPanelFullContent);
}

if (micBtn) {
    micBtn.addEventListener('click', toggleMic);
}
if (mobileMenuToggleBtn) {
    mobileMenuToggleBtn.addEventListener('click', openMobileMenu);
}
if (closeMobileMenuBtn) {
    closeMobileMenuBtn.addEventListener('click', closeMobileMenu);
}
if (closeDetailModalBtn) {
    closeDetailModalBtn.addEventListener('click', closeCardDetailModal);
}
document.getElementById('hizliBarToggleBtn')?.addEventListener('click', toggleHizliBar);

if (settingsMainBtn && settingsSubmenu) {
    settingsMainBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        settingsMenuOpen = !settingsMenuOpen;
        settingsSubmenu.style.display = settingsMenuOpen ? 'flex' : 'none';
        settingsMainBtn.textContent = settingsMenuOpen
            ? 'âš™ï¸ Ayarlar â–´'
            : 'âš™ï¸ Ayarlar â–¾';
    });
}

if (mobileSettingsMainBtn && mobileSettingsSubmenu) {
    mobileSettingsMainBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        mobileSettingsMenuOpen = !mobileSettingsMenuOpen;
        mobileSettingsSubmenu.style.display = mobileSettingsMenuOpen ? 'flex' : 'none';
        mobileSettingsMainBtn.textContent = mobileSettingsMenuOpen
            ? 'âš™ï¸ Ayarlar â–´'
            : 'âš™ï¸ Ayarlar â–¾';
    });
}



document.addEventListener('fullscreenchange', handleFullscreenChange);
window.addEventListener('load', handleResizeAndLoad);

window.addEventListener('resize', () => {
    const newMode = getViewportMode();

    // EÄŸer mobile â†” tablet â†” desktop modu DEÄÄ°ÅTÄ°YSE â†’ sayfayÄ± yenile
    if (newMode !== currentViewportMode) {
        currentViewportMode = newMode;
        window.location.reload();
    } else {
        // Sadece aynÄ± mod iÃ§inde boyut ufak ufak oynuyorsa, normal dÃ¼zenlemeyi yap
        handleResizeAndLoad();
    }
});


document.addEventListener('DOMContentLoaded', () => {
    // Sol panel sÄ±rasÄ±nÄ± ve gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ uygula
    applySolPanelConfig();

    // HÄ±zlÄ± EriÅŸim butonlarÄ±nÄ± config'e gÃ¶re kur
    buildQuickActionsBar();

    // AÃ§Ä±lÄ±ÅŸta layout + default panel iÃ§in
    handleResizeAndLoad();

    // Ayar ekranÄ±ndan dÃ¶nÃ¼lÃ¼p config deÄŸiÅŸirse: sol panel + hÄ±zlÄ± menÃ¼ gÃ¼ncellensin
    window.addEventListener('storage', (e) => {
        if (e.key === 'solPanelConfig') {
            applySolPanelConfig();

            // Ã–zelleÅŸtir ekranÄ±ndan dÃ¶nÃ¼ldÃ¼ â†’ ilk aÃ§Ä±k pencereyi tekrar seÃ§ebilmek iÃ§in sÄ±fÄ±rla
            initialViewApplied = false;
            handleResizeAndLoad();
        }

        if (e.key === 'quickAccessConfig') {
            buildQuickActionsBar();
        }
    });
});

function restoreInceWidthIfAny() {
  const saved = localStorage.getItem(STORAGE_KEY_INCE_WIDTH);
  const w = parseInt(saved, 10);
  if (!isNaN(w)) applyInceWidth(w);
}

function applyInceWidth(px) {

  if (window.matchMedia("(max-width: 768px)").matches) return;
  if (dashboardMode || solHidden) return;

  const wrapper = document.getElementById("mainWrapper");
  if (!wrapper) return;

  const maxWidth = wrapper.clientWidth - 105;
  const width = Math.max(MIN_INCE_WIDTH, Math.min(px, maxWidth));

  // px geniÅŸlik verince flex-basis kullanmak daha stabil
  solPanel.style.width = width + "px";
  solPanel.style.flex = `0 0 ${width}px`;

  // saÄŸ panel kalan alanÄ± alsÄ±n (yÃ¼zdeyi ezsin)
  if (sagPanel) {
    sagPanel.style.width = "auto";
    sagPanel.style.flex = "1 1 auto";
  }

  localStorage.setItem(STORAGE_KEY_INCE_WIDTH, String(width));
}

setTimeout(() => {

    if (window.matchMedia("(max-width: 768px)").matches) return;

    const saved = localStorage.getItem(STORAGE_KEY_INCE_WIDTH);
    if (saved && !isNaN(saved)) {
        applyInceWidth(parseInt(saved, 10));
    }
}, 0);


let isResizing = false;

inceSplitter.addEventListener("mousedown", (e) => {
    isResizing = true;
    document.body.classList.add("ince-resizing");
    e.preventDefault();
});

document.addEventListener("mousemove", (e) => {
    if (!isResizing) return;

    const rect = solPanel.getBoundingClientRect();
    let newWidth;

    if (document.body.classList.contains("ince-right")) {
        // panel saÄŸdaysa ters yÃ¶nde bÃ¼yÃ¼r
        newWidth = window.innerWidth - e.clientX;
    } else {
        // panel soldaysa normal
        newWidth = e.clientX - rect.left;
    }

    applyInceWidth(newWidth);
});

document.addEventListener("mouseup", () => {
    if (!isResizing) return;
    isResizing = false;
    document.body.classList.remove("ince-resizing");
});


function goToCustomize() {
  const url = "drhastabasiozellestir.html";

  // iframe/webview senaryolarÄ± iÃ§in en garantili sÄ±ra:
  try { window.top.location.href = url; return; } catch (e) {}
  try { window.parent.location.href = url; return; } catch (e) {}
  window.location.href = url;
}

</script>

	
</body>
</html>
